<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AI HAT â€“ Object Detection</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f0f;
      color: #eee;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      background: #1a1a2e;
      font-size: 1.1rem;
      font-weight: bold;
      border-bottom: 2px solid #4fc3f7;
    }
    header span { color: #4fc3f7; }

    header .model-badge {
      margin-left: auto;
      font-size: 0.72rem;
      font-weight: normal;
      color: #888;
      background: #111;
      border: 1px solid #2a2a2a;
      padding: 3px 10px;
      border-radius: 20px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 40%;
    }

    /* â”€â”€ Main two-panel layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
      gap: 8px;
      padding: 8px;
    }

    /* â”€â”€ Video panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #video-panel {
      flex: 3;
      display: flex;
      flex-direction: column;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
    }
    #video-panel .panel-title {
      padding: 6px 12px;
      background: #111;
      font-size: 0.85rem;
      color: #aaa;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #video-panel .panel-title #fps-badge {
      margin-left: auto;
      font-size: 0.72rem;
      color: #4fc3f7;
    }
    #video-panel img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* â”€â”€ Detection list panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #list-panel {
      flex: 1;
      min-width: 230px;
      display: flex;
      flex-direction: column;
      background: #161616;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #2a2a2a;
    }
    #list-panel .panel-title {
      padding: 10px 12px;
      background: #1a1a1a;
      font-size: 0.9rem;
      font-weight: bold;
      border-bottom: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #list-panel .panel-title #det-count {
      font-size: 0.75rem;
      color: #4fc3f7;
      background: #0d2a3a;
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* â”€â”€ Detection items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #detection-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }
    #detection-list::-webkit-scrollbar { width: 5px; }
    #detection-list::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

    .det-item {
      padding: 7px 10px;
      margin-bottom: 5px;
      border-radius: 7px;
      background: #1e1e1e;
      font-size: 0.84rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 3px solid #4fc3f7;
      animation: slideIn 0.2s ease;
    }
    .det-item .label { font-weight: bold; color: #4fc3f7; }
    .det-item .meta  { text-align: right; }
    .det-item .conf  { font-size: 0.8rem; color: #aaa; display: block; }
    .det-item .ts    { font-size: 0.72rem; color: #555; display: block; }

    .empty-msg {
      color: #444;
      text-align: center;
      margin-top: 40px;
      font-size: 0.85rem;
    }

    /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(8px); }
      to   { opacity: 1; transform: translateX(0);   }
    }
  </style>
</head>
<body>

  <header>
    ðŸ¤– <span>Hailo AI HAT</span>&nbsp;â€” Real-time Object Detection (YOLOv8 Â· COCO)
    <span class="model-badge" id="model-name">loadingâ€¦</span>
  </header>

  <main>
    <!-- Live camera stream -->
    <div id="video-panel">
      <div class="panel-title">
        ðŸ“· Live Camera Feed
        <span id="fps-badge"></span>
      </div>
      <img id="video-img" src="/video_feed" alt="Live camera feed"/>
    </div>

    <!-- Real-time detection list -->
    <div id="list-panel">
      <div class="panel-title">
        ðŸ“‹ Detected Objects
        <span id="det-count">0</span>
      </div>
      <div id="detection-list">
        <p class="empty-msg">Waiting for detectionsâ€¦</p>
      </div>
    </div>
  </main>

  <script>
    const listEl   = document.getElementById('detection-list');
    const countEl  = document.getElementById('det-count');
    const modelEl  = document.getElementById('model-name');
    const fpsEl    = document.getElementById('fps-badge');

    /* â”€â”€ Fetch server info (model name, threshold) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    fetch('/info')
      .then(r => r.json())
      .then(data => {
        modelEl.textContent = data.model;
        modelEl.title       = data.model;
      })
      .catch(() => { modelEl.textContent = ''; });

    /* â”€â”€ FPS counter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let frameCount = 0;
    const videoImg = document.getElementById('video-img');
    videoImg.addEventListener('load', () => { frameCount++; });
    setInterval(() => {
      fpsEl.textContent = `${frameCount} fps`;
      frameCount = 0;
    }, 1000);

    /* â”€â”€ SSE detection updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const src = new EventSource('/detections');

    src.onmessage = (e) => {
      const dets = JSON.parse(e.data);
      countEl.textContent = dets.length;

      if (!dets.length) {
        listEl.innerHTML = '<p class="empty-msg">No objects detected</p>';
        return;
      }

      listEl.innerHTML = dets.map(d =>
        `<div class="det-item">
           <span class="label">${d.label}</span>
           <span class="meta">
             <span class="conf">${d.confidence}%</span>
             <span class="ts">${d.time}</span>
           </span>
         </div>`
      ).join('');
    };

    src.onerror = () => { console.warn('SSE connection lost â€“ retryingâ€¦'); };
  </script>

</body>
</html>
