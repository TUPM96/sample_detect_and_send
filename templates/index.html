<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Hailo AI HAT â€“ PhÃ¡t hiá»‡n object thá»i gian thá»±c</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f0f;
      color: #eee;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 18px;
      background: #1a1a2e;
      border-bottom: 2px solid #4fc3f7;
    }
    header .title {
      font-size: 1.1rem;
      font-weight: bold;
    }
    header .title span { color: #4fc3f7; }
    header .meta {
      margin-left: auto;
      font-size: 0.85rem;
      color: #aaa;
    }
    header .meta strong { color: #4fc3f7; }

    /* â”€â”€ Main two-column layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
      gap: 8px;
      padding: 8px;
    }

    /* Left: video panel */
    #video-panel {
      flex: 3;
      display: flex;
      flex-direction: column;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
    }
    #video-panel .panel-title {
      padding: 6px 12px;
      background: #111;
      font-size: 0.85rem;
      color: #aaa;
    }
    #video-panel img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Right: detection list panel */
    #detect-panel {
      flex: 1;
      min-width: 220px;
      max-width: 300px;
      display: flex;
      flex-direction: column;
      background: #111;
      border-radius: 10px;
      overflow: hidden;
    }
    #detect-panel .panel-title {
      padding: 6px 12px;
      background: #1a1a2e;
      font-size: 0.85rem;
      color: #aaa;
      border-bottom: 1px solid #333;
    }
    #detect-list {
      flex: 1;
      overflow-y: auto;
      padding: 6px;
    }
    .det-item {
      padding: 7px 10px;
      margin-bottom: 5px;
      background: #1a1a2e;
      border-radius: 7px;
      font-size: 0.82rem;
      border-left: 3px solid #4fc3f7;
    }
    .det-item .det-name { font-weight: bold; color: #4fc3f7; font-size: 0.9rem; }
    .det-item .det-conf { color: #a5d6a7; }
    .det-item .det-time { color: #777; font-size: 0.75rem; margin-top: 2px; }
    #detect-list .empty { color: #555; text-align: center; padding: 20px; font-size: 0.85rem; }

    /* GPS widget at bottom of right panel */
    #gps-widget {
      padding: 8px 12px;
      background: #1a1a2e;
      border-top: 1px solid #333;
      font-size: 0.8rem;
    }
    #gps-widget .gps-title { color: #aaa; margin-bottom: 4px; }
    #gps-widget .gps-coords { color: #80cbc4; font-weight: bold; font-size: 0.85rem; }
    #gps-widget .gps-coords.no-fix { color: #555; font-weight: normal; }
  </style>
</head>
<body>

  <header>
    ğŸ¤– <div class="title"><span>Hailo AI HAT</span> â€” PhÃ¡t hiá»‡n object thá»i gian thá»±c</div>
    <div class="meta">
      Model: <strong id="hdr-model">â€¦</strong>
      &nbsp;|&nbsp;
      FPS: <strong id="hdr-fps">0</strong>
    </div>
  </header>

  <main>
    <div id="video-panel">
      <div class="panel-title">ğŸ“· Camera â€“ detection + tracking overlay</div>
      <img id="video-img" src="/camera_stream" alt="Live camera feed"/>
    </div>

    <div id="detect-panel">
      <div class="panel-title">ğŸ“‹ Danh sÃ¡ch object Ä‘ang detect</div>
      <div id="detect-list"><div class="empty">ChÆ°a cÃ³ object nÃ oâ€¦</div></div>
      <div id="gps-widget">
        <div class="gps-title">ğŸ“ Vá»‹ trÃ­ GPS</div>
        <div id="gps-coords" class="gps-coords no-fix">ChÆ°a cÃ³ tÃ­n hiá»‡uâ€¦</div>
      </div>
    </div>
  </main>

  <script>
    const hdrModel   = document.getElementById('hdr-model');
    const hdrFps     = document.getElementById('hdr-fps');
    const detectList = document.getElementById('detect-list');
    const gpsCoords  = document.getElementById('gps-coords');

    async function fetchDetections() {
      try {
        const res  = await fetch('/detections');
        const data = await res.json();

        if (data.model) hdrModel.textContent = data.model;
        hdrFps.textContent = (data.fps != null) ? data.fps.toFixed(1) : '0';

        const items = data.detections || [];
        if (items.length === 0) {
          detectList.innerHTML = '<div class="empty">ChÆ°a cÃ³ object nÃ oâ€¦</div>';
        } else {
          detectList.innerHTML = items.map(d => `
            <div class="det-item">
              <div class="det-name">${d.class}</div>
              <div class="det-conf">Confidence: ${(d.confidence * 100).toFixed(1)}%</div>
              <div class="det-time">${d.detected_at}</div>
            </div>
          `).join('');
        }

        const gps = data.gps;
        if (gps && gps.lat != null && gps.lon != null) {
          gpsCoords.className = 'gps-coords';
          gpsCoords.textContent = `${gps.lat.toFixed(6)}, ${gps.lon.toFixed(6)}`;
        } else {
          gpsCoords.className = 'gps-coords no-fix';
          gpsCoords.textContent = 'ChÆ°a cÃ³ tÃ­n hiá»‡uâ€¦';
        }
      } catch (e) {
        console.warn('fetch /detections failed:', e);
      }
    }

    fetchDetections();
    setInterval(fetchDetections, 500);
  </script>

</body>
</html>

